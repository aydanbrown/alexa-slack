var alexa = require('alexa');
var slack = require('slack');

// Called when the user launches the skill without specifying an intent
exports.Launch = function(request, session, next) {
  var sessionAttributes = { name: 'Alexa' };
  var cardTitle = "Welcome";
  var speechOutput = "Welcome to Slack";
  var repromptText = "If you are unsure, you can ask for help";

  callback(sessionAttributes, alexa.utilities.buildSpeechlet('cardTitle', speechOutput, repromptText, false));
}

// Called when no intent was defined
exports.None = function(intent, session, next) {
  var cardTitle = 'Couldn\'t understand';
  var outputSpeech = 'Sorry, I couldn\'t understand what want, please try again';
  var repromptSpeech = 'If you are having trouble, you can ask for help';

  next(session.attributes, alexa.utilities.buildSpeechlet(cardTitle, outputSpeech, repromptSpeech, false));
}

// Called when a user invokes the default help intent
exports.Help = function(intent, session, next) {
  var cardTitle = 'Slack Help';
  var outputSpeech = 'You can join a channel by saying join, then the channel name. ' +
  'You can send a message with say, followed by the message you want to send. ' +
  'Have fun slacking!';

  next(session.attributes, alexa.utilities.buildSpeechlet(cardTitle, outputSpeech, '', false));
}

// Called when the session is ended
exports.End = function(intent, session, next) {
  var cardTitle = 'Session Ended';
  var speechOutput = 'Have a nice day';

  next({}, alexa.utilities.buildSpeechlet(cardTitle, speechOutput, null, true));
}

exports.JoinChannel = function(intent, session, next) {
  var channelSlot = intent.slots.Channel.value;
  var outputSpeech = '';

  console.log('JoinChannel - Channel=' + channelSlot);

  slack('channels.list', {})
  .on('success', function(res) {

  })
  .on('error', function(err) {

  })

}
