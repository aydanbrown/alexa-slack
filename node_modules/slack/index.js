const request = require('request');

module.exports = function (token) {
  this.token = token;

  this.api = function(method, options, next) {
    var query = [ `token=${this.token}` ];
    for(o in options) { query.push(`${o}=${options[o]}`); }
    request(`https://slack.com/api/${method}?${query.join('&')}`, function(err, res, body) {
      if(err) return next(err);
      next(false, JSON.parse(body));
    });
  }

  return this.api;
}
